<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <title>SkillPathIA</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/styles_cursos.css">
  <link rel="stylesheet" href="css/stylesMR.css">
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
  <a class="navbar-brand" href="index.html">
      <img src="assets/icons/logo.png" alt="Logo" />
      <span class="brand-skill">SkillPath</span><span class="brand-ia">IA</span>
  </a>
    <nav class="navbar-cursos">
      <a href="lista_cursos.html" class="nav-cursos">Cursos</a>
    </nav>
    <div class="navbar-busqueda">
      <form class="search-form" action="#" method="get">
        <input type="text" name="q" placeholder="Buscar cursos..." aria-label="Buscar cursos" />
      </form>
    </div>
    <input type="checkbox" id="menu-toggle" class="menu-toggle" />
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <div class="navbar-derecha">
      <nav class="navbar-precios">
        <a href="index.html" class="btn-primary">Precios</a>
      </nav>
      <div class="navbar-avatar navbar-avatar-desktop">
        <img src="assets/images/perfil.jpg" alt="Avatar de usuario" />
      </div>
    </div>
    <hr class="linea-divisoria">
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <nav class="sidebar-menu">
        <a href="index.html"><i class="fas fa-home"></i><span class="sidebar-text">Inicio</span></a>
        <a href="mis_rutas.html"><i class="fas fa-route"></i><span class="sidebar-text">Mis Rutas</span></a>
        <a href="ver_comunidad.html"><i class="fas fa-users"></i><span class="sidebar-text">Comunidad</span></a>
        <a href="dashboard.html"><i class="fas fa-chart-line"></i><span class="sidebar-text">Dashboard</span></a>
        <div class="navbar-avatar navbar-avatar-mobile">
          <img src="assets/images/perfil.jpg" alt="Avatar de usuario" />
        </div>
    </nav>
    <div class="sidebar-toggle" id="sidebarToggle">&lt;&lt;</div>
  </aside>
  <main class="container" style="margin-left:250px; margin-top:60px; width:calc(100vw - 250px); max-width:none; padding-left:40px; padding-right:40px;">
  <div id="headerMisRutas" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 32px; border-bottom: 1px solid #2E696B; padding-bottom: 16px;">
    <h1 style="margin: 0; font-size: 2rem;">Mis Rutas</h1>
    <button class="btn-primary" style="height: 40px; margin-right: 32px;" id="abrirModalRuta">Crear una ruta</button>
  </div>
  <div id="rutasContainer"></div>
  <div id="detalleRuta" style="display:none;">
    <div style="margin-bottom: 24px; border-bottom: 1px solid #2E696B; padding-bottom: 16px;">
      <button id="volverRutas" class="btn-primary" style="margin-bottom:16px;">&larr; Volver</button>
      <h1 id="nombreRutaDetalle" style="margin: 0 0 8px 0; font-size: 2rem; color: #fff;">Ruta</h1>
      <span style="color: #8CCCCF; font-size: 1rem;">Ruta Personalizada</span>
    </div>
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 50vh;">
      <h2 style="color:#fff; font-size:1.3rem; margin-bottom:8px;">Aún no tienes cursos en esta ruta</h2>
      <p style="color:#8CCCCF; font-size:1.1rem; margin-bottom:24px; text-align:center;">Explora los cursos que tenemos para ti y agrégalos a esta ruta.</p>
      <button class="btn-primary" style="padding: 0.7rem 1.5rem; font-size:1rem;">Explorar Cursos</button>
    </div>
  </div>
  <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 50vh;" id="estadoVacio">
      <p style="font-size: 1.2rem; text-align: center; font-weight: bold; margin-bottom: 16px;">Todavía no tienes cursos en esta ruta.<br>Pregúntale al chat por una ruta personalizada o crea una desde cero.</p>
      <button class="btn-primary" style="height: 40px; margin-top: 8px;" id="abrirModalRutaCentro">Crear una ruta</button>
    </div>
    <!-- Notificación de ruta creada -->
    <div id="notificacionRuta" style="display:none; position:fixed; left:50%; bottom:32px; transform:translateX(-50%); background:#fff; color:#222; border-radius:16px; box-shadow:0 2px 16px rgba(0,0,0,0.2); padding:20px 40px; font-size:1.2rem; z-index:10000; display:flex; align-items:center; gap:12px; min-width:220px; visibility:hidden;">
      <span style="font-size:1.5rem;">&#43;</span> Ruta creada
      <button id="cerrarNotificacionRuta" style="background:none; border:none; font-size:1.5rem; margin-left:auto; cursor:pointer;">&times;</button>
    </div>
    <!-- Notificación de ruta eliminada -->
    <div id="notificacionEliminada" style="display:none; position:fixed; left:50%; bottom:32px; transform:translateX(-50%); background:#fff; color:#222; border-radius:16px; box-shadow:0 2px 16px rgba(0,0,0,0.2); padding:20px 40px; font-size:1.2rem; z-index:10000; display:flex; align-items:center; gap:12px; min-width:280px; visibility:hidden;">
      <span style="font-size:1.5rem;">&#128465;</span> Se eliminó la ruta correctamente
      <button id="cerrarNotificacionEliminada" style="background:none; border:none; font-size:1.5rem; margin-left:auto; cursor:pointer;">&times;</button>
    </div>
    <!-- Modal para crear nueva ruta -->
    <div id="modalNuevaRuta" class="modal-ruta">
      <div class="modal-ruta-content">
        <button id="cerrarModalRuta" class="modal-ruta-close">&times;</button>
        <h2>Nueva ruta de estudio</h2>
        <input type="text" id="nombreNuevaRuta" placeholder="Nombre de la nueva ruta" class="input-ruta" />
        <button class="btn-primary" id="crearRutaModal">Crear</button>
      </div>
    </div>
  </main>
  <script>
    // Sidebar collapse functionality (igual que en index)
    document.addEventListener("DOMContentLoaded", function () {
      const sidebar = document.getElementById("sidebar");
      const sidebarToggle = document.getElementById("sidebarToggle");
      if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener("click", () => {
          sidebar.classList.toggle("collapsed");
          document.body.classList.toggle("sidebar-collapsed");
          sidebarToggle.innerHTML = sidebar.classList.contains("collapsed") ? "&gt;&gt;" : "&lt;&lt;";
        });
      }
    });

    // Utilidades para localStorage
    function obtenerRutas() {
      return JSON.parse(localStorage.getItem('rutasUsuario') || '[]');
    }
    function guardarRutas(rutas) {
      localStorage.setItem('rutasUsuario', JSON.stringify(rutas));
    }

    // Renderizar rutas al cargar
    function renderizarRutas() {
      var rutas = obtenerRutas();
      var rutasContainer = document.getElementById('rutasContainer');
      var estadoVacio = document.getElementById('estadoVacio');
      rutasContainer.innerHTML = '';
      if (rutas.length === 0) {
        if (estadoVacio) estadoVacio.style.display = 'flex';
      } else {
        if (estadoVacio) estadoVacio.style.display = 'none';
        rutas.forEach(function(nombre) {
          crearRuta(nombre, false);
        });
      }
      // Si hay hash en la URL, mostrar el detalle de esa ruta automáticamente
      if (window.location.hash) {
        const rutaHash = decodeURIComponent(window.location.hash.substring(1));
        if (rutas.includes(rutaHash)) {
          setTimeout(function() {
            mostrarDetalleRuta(rutaHash);
          }, 0);
        }
      }
    }

    // Modifico crearRuta para aceptar un flag de guardar
    function crearRuta(nombre, guardar = true) {
      var rutasContainer = document.getElementById('rutasContainer');
      var estadoVacio = document.getElementById('estadoVacio');
      if (estadoVacio) estadoVacio.style.display = 'none';
      var ruta = document.createElement('div');
      ruta.className = 'ruta-item';
      ruta.style.display = 'flex';
      ruta.style.alignItems = 'center';
      ruta.style.gap = '16px';
      ruta.style.margin = '32px 0 0 0';
      ruta.style.padding = '16px 24px';
      ruta.style.borderRadius = '16px';
      ruta.innerHTML = `
        <div style=\"background:#2E696B; color:#fff; width:56px; height:56px; border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold;\">${nombre[0].toUpperCase()}</div>
        <div>
          <div style=\"font-size:1.2rem; font-weight:bold; color:#fff;\">${nombre}</div>
          <div style=\"font-size:0.95rem; color:#8CCCCF;\">Ruta Personalizada | 0 Cursos</div>
        </div>
        <div style=\"flex:1;\"></div>
        <div style=\"width:180px; display:flex; align-items:center; gap:8px;\">
          <span style=\"color:#8CCCCF; font-size:0.95rem;\">0%</span>
          <div style=\"flex:1; height:6px; background:#214A4A; border-radius:4px;\"></div>
          <button class=\"eliminarRutaBtn\" style=\"background:none; border:none; color:#8CCCCF; font-size:1.2rem; cursor:pointer;\" title=\"Eliminar ruta\">&#128465;</button>
        </div>
      `;
      rutasContainer.appendChild(ruta);
      // Eliminar ruta
      ruta.querySelector('.eliminarRutaBtn').onclick = function(e) {
        e.stopPropagation();
        rutasContainer.removeChild(ruta);
        var rutas = obtenerRutas();
        rutas = rutas.filter(function(r) { return r !== nombre; });
        guardarRutas(rutas);
        mostrarNotificacionEliminada && mostrarNotificacionEliminada();
        if (rutasContainer.children.length === 0 && estadoVacio) {
          estadoVacio.style.display = 'flex';
        }
      };
      // Redirigir al hacer click en la ruta (excepto en la basurita)
      ruta.onclick = function(e) {
        if (!e.target.classList.contains('eliminarRutaBtn')) {
          mostrarDetalleRuta(nombre);
        }
      };
      // Guardar en localStorage si corresponde
      if (guardar) {
        var rutas = obtenerRutas();
        rutas.push(nombre);
        guardarRutas(rutas);
      }
    }

    function mostrarNotificacionRuta() {
      ocultarNotificacionEliminada();
      var notif = document.getElementById('notificacionRuta');
      notif.style.display = 'flex';
      notif.style.visibility = 'visible';
    }
    function ocultarNotificacionRuta() {
      var notif = document.getElementById('notificacionRuta');
      notif.style.display = 'none';
      notif.style.visibility = 'hidden';
    }
    ocultarNotificacionRuta();
    document.getElementById('cerrarNotificacionRuta').onclick = ocultarNotificacionRuta;

    function mostrarNotificacionEliminada() {
      ocultarNotificacionRuta();
      var notif = document.getElementById('notificacionEliminada');
      notif.style.display = 'flex';
      notif.style.visibility = 'visible';
    }
    function ocultarNotificacionEliminada() {
      var notif = document.getElementById('notificacionEliminada');
      notif.style.display = 'none';
      notif.style.visibility = 'hidden';
    }
    ocultarNotificacionEliminada();
    document.getElementById('cerrarNotificacionEliminada').onclick = ocultarNotificacionEliminada;

    // Sobrescribo el evento de crear para usar el nuevo crearRuta
    document.getElementById('crearRutaModal').onclick = function() {
      var input = document.getElementById('nombreNuevaRuta');
      var btn = document.getElementById('crearRutaModal');
      if (!input.value.trim()) {
        btn.style.backgroundColor = '#e74c3c';
        btn.style.color = '#fff';
        setTimeout(function(){
          btn.style.backgroundColor = '';
          btn.style.color = '';
        }, 1000);
        input.focus();
        return;
      }
      crearRuta(input.value.trim(), true);
      document.getElementById('modalNuevaRuta').style.display = 'none';
      input.value = '';
      mostrarNotificacionRuta();
    };

    // Mostrar detalle de ruta en la misma página
    function mostrarDetalleRuta(nombre) {
      document.getElementById('rutasContainer').style.display = 'none';
      var estadoVacio = document.getElementById('estadoVacio');
      if (estadoVacio) estadoVacio.style.display = 'none';
      document.getElementById('detalleRuta').style.display = 'block';
      document.getElementById('nombreRutaDetalle').textContent = nombre;
      // Oculta el header con el botón "Crear una ruta"
      var header = document.getElementById('headerMisRutas');
      if (header) header.style.display = 'none';
    }

    function volverAListaRutas() {
      document.getElementById('detalleRuta').style.display = 'none';
      document.getElementById('rutasContainer').style.display = '';
      var rutas = obtenerRutas();
      var estadoVacio = document.getElementById('estadoVacio');
      if (rutas.length === 0 && estadoVacio) estadoVacio.style.display = 'flex';
      // Muestra el header con el botón "Crear una ruta"
      var header = document.getElementById('headerMisRutas');
      if (header) header.style.display = 'flex';
    }

    // Inicializar botón volver
    function inicializarBotones() {
      document.getElementById('abrirModalRuta').onclick = function() {
        document.getElementById('modalNuevaRuta').style.display = 'flex';
      };
      var btnCentro = document.getElementById('abrirModalRutaCentro');
      if (btnCentro) {
        btnCentro.onclick = function() {
          document.getElementById('modalNuevaRuta').style.display = 'flex';
        };
      }
      document.getElementById('cerrarModalRuta').onclick = function() {
        document.getElementById('modalNuevaRuta').style.display = 'none';
      };
      document.getElementById('modalNuevaRuta').onclick = function(e) {
        if (e.target === this) this.style.display = 'none';
      };
      var cerrarNotif = document.getElementById('cerrarNotificacionRuta');
      if (cerrarNotif) cerrarNotif.onclick = ocultarNotificacionRuta;
      var cerrarNotifElim = document.getElementById('cerrarNotificacionEliminada');
      if (cerrarNotifElim) cerrarNotifElim.onclick = ocultarNotificacionEliminada;
      var volverBtn = document.getElementById('volverRutas');
      if (volverBtn) volverBtn.onclick = volverAListaRutas;
    }
    // Llamar después de renderizar rutas
    renderizarRutas();
    inicializarBotones();
  </script>
</body>
</html>